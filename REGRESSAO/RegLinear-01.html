<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regressão Linear</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="RegLinear-01_files/libs/clipboard/clipboard.min.js"></script>
<script src="RegLinear-01_files/libs/quarto-html/quarto.js"></script>
<script src="RegLinear-01_files/libs/quarto-html/popper.min.js"></script>
<script src="RegLinear-01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="RegLinear-01_files/libs/quarto-html/anchor.min.js"></script>
<link href="RegLinear-01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RegLinear-01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RegLinear-01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RegLinear-01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RegLinear-01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="RegLinear-01_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="RegLinear-01_files/libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="RegLinear-01_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="RegLinear-01_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="RegLinear-01_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="RegLinear-01_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="RegLinear-01_files/libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="RegLinear-01_files/libs/plotly-main-2.5.1/plotly-latest.min.js"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#base-de-dados" id="toc-base-de-dados" class="nav-link active" data-scroll-target="#base-de-dados">Base de Dados</a></li>
  <li><a href="#variável-dependente" id="toc-variável-dependente" class="nav-link" data-scroll-target="#variável-dependente">Variável dependente</a>
  <ul class="collapse">
  <li><a href="#visualizando-a-variável-dependente" id="toc-visualizando-a-variável-dependente" class="nav-link" data-scroll-target="#visualizando-a-variável-dependente">Visualizando a variável dependente:</a></li>
  <li><a href="#teste-de-normalidade-shapiro-francia" id="toc-teste-de-normalidade-shapiro-francia" class="nav-link" data-scroll-target="#teste-de-normalidade-shapiro-francia">Teste de Normalidade Shapiro-Francia</a></li>
  </ul></li>
  <li><a href="#regressão-univariada" id="toc-regressão-univariada" class="nav-link" data-scroll-target="#regressão-univariada">Regressão univariada</a>
  <ul class="collapse">
  <li><a href="#correlação" id="toc-correlação" class="nav-link" data-scroll-target="#correlação">Correlação</a></li>
  <li><a href="#gráfico-de-dispersão" id="toc-gráfico-de-dispersão" class="nav-link" data-scroll-target="#gráfico-de-dispersão">Gráfico de dispersão:</a></li>
  <li><a href="#criando-um-modelo-linear-simples" id="toc-criando-um-modelo-linear-simples" class="nav-link" data-scroll-target="#criando-um-modelo-linear-simples">Criando um modelo linear simples</a></li>
  <li><a href="#visualizando-a-inferência" id="toc-visualizando-a-inferência" class="nav-link" data-scroll-target="#visualizando-a-inferência">Visualizando a inferência:</a></li>
  </ul></li>
  <li><a href="#regressão-multivariada" id="toc-regressão-multivariada" class="nav-link" data-scroll-target="#regressão-multivariada">Regressão multivariada</a>
  <ul class="collapse">
  <li><a href="#correlações" id="toc-correlações" class="nav-link" data-scroll-target="#correlações">Correlações</a></li>
  <li><a href="#criando-um-modelo-multivariado" id="toc-criando-um-modelo-multivariado" class="nav-link" data-scroll-target="#criando-um-modelo-multivariado">Criando um modelo multivariado</a></li>
  <li><a href="#comparando-os-modelos" id="toc-comparando-os-modelos" class="nav-link" data-scroll-target="#comparando-os-modelos">Comparando os modelos</a></li>
  <li><a href="#resíduos-e-homocedasticidade" id="toc-resíduos-e-homocedasticidade" class="nav-link" data-scroll-target="#resíduos-e-homocedasticidade">Resíduos e Homocedasticidade</a></li>
  <li><a href="#transformação-de-box-cox" id="toc-transformação-de-box-cox" class="nav-link" data-scroll-target="#transformação-de-box-cox">Transformação de Box-Cox</a></li>
  <li><a href="#salvando-os-fitted-values-box-cox" id="toc-salvando-os-fitted-values-box-cox" class="nav-link" data-scroll-target="#salvando-os-fitted-values-box-cox">Salvando os fitted values Box-Cox:</a></li>
  <li><a href="#visualizando-a-inferência-1" id="toc-visualizando-a-inferência-1" class="nav-link" data-scroll-target="#visualizando-a-inferência-1">Visualizando a inferência:</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regressão Linear</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (plotly)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="base-de-dados" class="level1">
<h1>Base de Dados</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecionar base mtcars e criar uma coluna com os nomes dos modelos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 12
   name          mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Mazda RX4    21       6  160    110  3.9   2.62  16.5     0     1     4     4
 2 Mazda RX4 …  21       6  160    110  3.9   2.88  17.0     0     1     4     4
 3 Datsun 710   22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
 4 Hornet 4 D…  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
 5 Hornet Spo…  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
 6 Valiant      18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
 7 Duster 360   14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
 8 Merc 240D    24.4     4  147.    62  3.69  3.19  20       1     0     4     2
 9 Merc 230     22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
10 Merc 280     19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
# … with 22 more rows</code></pre>
</div>
</div>
</section>
<section id="variável-dependente" class="level1">
<h1>Variável dependente</h1>
<p>Iremos selecionar como variável dependente o consumo (mpg).</p>
<section id="visualizando-a-variável-dependente" class="level2">
<h2 class="anchored" data-anchor-id="visualizando-a-variável-dependente">Visualizando a variável dependente:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mpg)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="teste-de-normalidade-shapiro-francia" class="level2">
<h2 class="anchored" data-anchor-id="teste-de-normalidade-shapiro-francia">Teste de Normalidade Shapiro-Francia</h2>
<p>Veja que este <strong>NÃO</strong> é uma premissa para uso da técnica, isso é geralmente na validação dos resíduos conforme veremos mais adiante. Estamos apenas apresentando como fazer o teste e analisando a variável dependente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste de normalidade Shapiro-Francia</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p-valor &lt;= 0.5 é não-normal, ou seja, maior a variável é normal</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sf.test</span>(df<span class="sc">$</span>mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Francia normality test

data:  df$mpg
W = 0.95247, p-value = 0.1495</code></pre>
</div>
</div>
</section>
</section>
<section id="regressão-univariada" class="level1">
<h1>Regressão univariada</h1>
<p>Com já temos nossa variável dependente o consumo (mpg), iremos definir como variável explicativa, a potência (hp).</p>
<section id="correlação" class="level2">
<h2 class="anchored" data-anchor-id="correlação">Correlação</h2>
<p>Iremos inicialmente entender como a variável dependente (mpg) está relacionada com a variável explicativa (hp). Por se tratar de duas variáveis quantitativas, iremos utilizar a correlação de Pearson. Este é um coeficiente que informa o quão forte é esta correlação, variando de -1 até 1. Sendo: - Negativa (-1) - Quanto <strong>maior</strong> a variável dependente <strong>menor</strong> a variável explicativa - Neutra (0) - Não há correlação entre as variáveis - Positiva (1) - Quanto <strong>maior</strong> a variável dependente <strong>maior</strong> a variável</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variável explicativa escolhida = hp</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df<span class="sc">$</span>mpg, df<span class="sc">$</span>hp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7761684</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>DataExplorer<span class="sc">::</span><span class="fu">plot_correlation</span>(df[<span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"hp"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nesta caso temos uma considerável correlação negativa (-0.78), ou seja, quanto menor a potência, maior o consumo.</p>
</section>
<section id="gráfico-de-dispersão" class="level2">
<h2 class="anchored" data-anchor-id="gráfico-de-dispersão">Gráfico de dispersão:</h2>
<p>Atraǘes do gráfico abaixo, podemos ter uma nocção visual do que representa a correlação de -0.78. Veja que se traçarmos uma reta atráves dos pontos, quanto maior o valor de mpg, menor o valor de hp e vice versa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y=</span> mpg)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)<span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkgray"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="criando-um-modelo-linear-simples" class="level2">
<h2 class="anchored" data-anchor-id="criando-um-modelo-linear-simples">Criando um modelo linear simples</h2>
<p>No caso de uma regressão linear simples, temos a seguinte equação:</p>
<p>Função: <span class="math inline">\hat{y} = \alpha + \beta * X1</span></p>
<p>O código abaixo, através da função “lm” irá criar um modelo de regressão linear simples, estimando os parâmetros para a equação de nossa reta. Não iremos cobrir os detalhes deste processo, mas há diversos métodos para encontrar estes coeficientes, como Mínimos Quadrados Ordinários (OLS), Máxima Verossimilhança (MLE), entre outros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Função lm para obter os coeficientes alpha e beta</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>modelo_uni <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp, <span class="at">data =</span> df)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>modelo_uni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ hp, data = df)

Coefficients:
(Intercept)           hp  
   30.09886     -0.06823  </code></pre>
</div>
</div>
<p>Onde, o <span class="math inline">\hat{y}</span> representa o valor previsto de nosso modelo, o <span class="math inline">\alpha</span> o intercepto da reta e o <span class="math inline">\beta</span> a inclinação da reta. <span class="math inline">X1</span> neste caso seria nossa variável explicativa (hp).</p>
<p>Neste caso, nosssa função ficaria:</p>
<p><span class="math inline">\hat{y} = (30.09886) + [(-0.06823) * X1]</span></p>
<p>Ou seja, se quisermos prever o consumo (mpg) à partir apenas da variável explicativa potencia (hp), faríamos:</p>
<p><span class="math inline">(30.09886) + [(-0.06823) * hp]</span></p>
<p>Por exemplo, de acordo com nosso modelo, para um veículo com 190 de potência, teremos:</p>
<p><span class="math inline">(30.09886) + [(-0.06823) * 190]</span> <span class="math inline">(30.09886) - 12.9637 = \textbf{17.13516}</span></p>
<p>Ou seja, nosso modelo prevê um consumo de 17.13 milhas por galão se um veículo tiver 190 de potência.</p>
<p>Com o modelo criado anteriormente, podemos utilizar a função <strong>summary</strong>() para extrair algumas informações bem importantes. Vejamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_uni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ hp, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.7121 -2.1122 -0.8854  1.5819  8.2360 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 30.09886    1.63392  18.421  &lt; 2e-16 ***
hp          -0.06823    0.01012  -6.742 1.79e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.863 on 30 degrees of freedom
Multiple R-squared:  0.6024,    Adjusted R-squared:  0.5892 
F-statistic: 45.46 on 1 and 30 DF,  p-value: 1.788e-07</code></pre>
</div>
</div>
<p>Há diversos resultados a serem observados, dentre eles, podemos observar que a estatística F, com p-value menor que 0.05 basicamente nos indica que nosso modelo é estatisticamente melhor que um modelo onde não temos uma variável explicativa, ou seja, apenas usando a média dos valores.</p>
<p>Observamos também que a cada -0.06823 de redução da potência (hp), temos uma economia de uma unidade de consumo (mpg). A estatística T, também se mostra significante à 5% de significância para a variável (hp). Isto faz sentido, já que temos apenas esta variável em nosso modelo e já vimos que tínhamos modelo atraǘes da estatística F.</p>
</section>
<section id="visualizando-a-inferência" class="level2">
<h2 class="anchored" data-anchor-id="visualizando-a-inferência">Visualizando a inferência:</h2>
<p>O gráfico abaixo, mostra nossa estimativa de consumo para um veículo de 190 hps. Note que se tivessemos utilizado apenas a média, nossa estimativa seria pior que o modelo que criamos, pois ela seria de 20.1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Média da variável mpg:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">media =</span> <span class="fu">round</span>(<span class="fu">mean</span>(mpg), <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  media
  &lt;dbl&gt;
1  20.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico da estimativa do modelo e uma reta com a média da variável:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y=</span> mpg)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)<span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">20.1</span>, <span class="at">slope =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">190</span>, <span class="at">y =</span> <span class="fl">20.1</span>),<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkgray"</span>)<span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">190</span>, <span class="at">y =</span> <span class="fl">17.13</span>),<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Usando a função <strong>predict</strong>().</p>
<p>Podemos utilizar a função <strong>predict</strong> para obter inferências do modelo criado ao invés do cálculo manual como fizemos anteriormente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_previsao <span class="ot">=</span> <span class="fu">tibble</span>(<span class="st">"hp"</span> <span class="ot">=</span> <span class="dv">190</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(modelo_uni, <span class="at">newdata =</span> df_previsao)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
17.13549 </code></pre>
</div>
</div>
<p>Coeficiente de ajuste do modelo <span class="math inline">R^2</span></p>
<p>O coeficiente <span class="math inline">R^2</span> pode ser utilizado como o coeficiente de ajuste do modelo, ou seja, o quanto da variância da variável dependente pode se explicada pela variável explicativa.</p>
<p>Utilizamos a função summary para obter seu valor. Também podemos utilizar a correlação de Pearson calculada anteriormente para calculá-lo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Obtendo o R2</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_uni)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6024373</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Validando o R2, extraindo a raiz, deve bater com a correlação anterior.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">summary</span>(modelo_uni)<span class="sc">$</span>r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7761684</code></pre>
</div>
</div>
</section>
</section>
<section id="regressão-multivariada" class="level1">
<h1>Regressão multivariada</h1>
<p>Adicionando outra variável explicativa peso (wt).</p>
<section id="correlações" class="level2">
<h2 class="anchored" data-anchor-id="correlações">Correlações</h2>
<p>Por se tratar de outra variável quantitativa, iremos utilizar a correlação de Pearson para entender como estas variáveis se correlacionam:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>DataExplorer<span class="sc">::</span><span class="fu">plot_correlation</span>(df[<span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"hp"</span>, <span class="st">"wt"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Assim como a potência (hp), vemos que há uma considerável correlação negativa com a variável peso (wt).</p>
</section>
<section id="criando-um-modelo-multivariado" class="level2">
<h2 class="anchored" data-anchor-id="criando-um-modelo-multivariado">Criando um modelo multivariado</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Função lm para obter os coeficientes alpha e beta das duas variáveis (hp e wt)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>modelo_multi_1<span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp <span class="sc">+</span> wt, <span class="at">data =</span> df)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>modelo_multi_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ hp + wt, data = df)

Coefficients:
(Intercept)           hp           wt  
   37.22727     -0.03177     -3.87783  </code></pre>
</div>
</div>
<p>Através da função <strong>summary</strong>() podemos observar que tanto a estatística F (do modelo), quanto as duas variáveis (estatística T) passam com um grau de confiança de 95%:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_multi_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ hp + wt, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-3.941 -1.600 -0.182  1.050  5.854 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 37.22727    1.59879  23.285  &lt; 2e-16 ***
hp          -0.03177    0.00903  -3.519  0.00145 ** 
wt          -3.87783    0.63273  -6.129 1.12e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.593 on 29 degrees of freedom
Multiple R-squared:  0.8268,    Adjusted R-squared:  0.8148 
F-statistic: 69.21 on 2 and 29 DF,  p-value: 9.109e-12</code></pre>
</div>
</div>
</section>
<section id="comparando-os-modelos" class="level2">
<h2 class="anchored" data-anchor-id="comparando-os-modelos">Comparando os modelos</h2>
<p>Podemos utilizar o <span class="math inline">R^2</span> para comparar o coeficiente de ajuste dos modelos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_uni)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6024373</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_multi_1)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8267855</code></pre>
</div>
</div>
<p>Neste caso, observamos que adicionando a variável peso, conseguimos explicar 82% da variância da variável dependente de consumo (mpg) ao invés dos 60% quando tínhamos apenas a variável pontência (hp).</p>
</section>
<section id="resíduos-e-homocedasticidade" class="level2">
<h2 class="anchored" data-anchor-id="resíduos-e-homocedasticidade">Resíduos e Homocedasticidade</h2>
<p>A regressão linear possui algumas premissas que devem ser observadas. Os gráficos a seguir, nos ajudam a entender se os resíduos seguem uma distribuição normal, se há outliers, e se temos homocedasticidade, ou seja, variância homogênia nos resíduos. Estas premissas são importantes para a acurácia de uma modelo de regressão linear.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (modelo_multi_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para validar a leitura dos gráficos anteriores, podemos utilizar os testes estatísticos a seguir:</p>
<p><strong>Normalidade dos resíduos</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste sharpiro-francia (ou sharpiro-wilk para amostrar &lt; 30)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(modelo_multi_1<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  modelo_multi_1$residuals
W = 0.92792, p-value = 0.03427</code></pre>
</div>
</div>
<p>Como podemos observar, nossos resíduos não passam no teste de normalidade (p-value &lt;= 0.05). A seguir deixaremos os demais testes com o código, mas devemos fazer algo a respeito desta premissa não atendida.</p>
<p><strong>Outliers nos resíduos</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Os resíduos PADRONIZADOS devem estar entre -3 e +3 e mediana perto de zero</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rstandard</span>(modelo_multi_1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1.54564 -0.63032 -0.07358  0.01855  0.44828  2.37862 </code></pre>
</div>
</div>
<p>No caso acima, não temos outliers nos resíduos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Independência dos resíduos. Não se aplicaria aqui, mas deixamos o código. Em geral, quando temos análise longitudinal (medidas repetidas), ex. Time series.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Recomendação de 1 e 3. p-value &gt; 0.05 os resíduos são independentes. Teste adequando quando os resíduos atendem a normalidade.</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">durbinWatsonTest</span>(modelo_multi_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> lag Autocorrelation D-W Statistic p-value
   1       0.2954091      1.362399   0.034
 Alternative hypothesis: rho != 0</code></pre>
</div>
</div>
<p>Homocedasticidade:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Teste de Breush-Pagan. Também tem premissa de normalidade nos resíduos.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#H0 existe homocedasticidade e H1 Não existe, ou sejá, tem Heterocedasticidade.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste caso, p-valor &gt; 0.05, portanto temos homocedasticidade.</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">bptest</span>(modelo_multi_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  modelo_multi_1
BP = 0.88072, df = 2, p-value = 0.6438</code></pre>
</div>
</div>
<p>Como nossa premissa de normalidade dos resíduos não foi antendida, podemos tentar fazer um transformação não linear em nossa variável dependente.</p>
</section>
<section id="transformação-de-box-cox" class="level2">
<h2 class="anchored" data-anchor-id="transformação-de-box-cox">Transformação de Box-Cox</h2>
<p>Ao fazer uma transformação na variável dependente através de uma <strong>Transformação de Box-Cox</strong>, podemos ter uma variação mais uniforme. Vamos testar, criando um modelo atraveś de uma nova variável que possui uma transformação de Box-Cox da variável mpg e iremos analizar seus resíduos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Transformação de Box-Cox</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimando o lambda de BoxCox </span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>lambda_BC <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">powerTransform</span>(df2<span class="sc">$</span>mpg)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>lambda_BC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated transformation parameter 
   df2$mpg 
0.02956537 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adicionando na base de dados: --&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>mpg_bc <span class="ot">&lt;-</span> (((df2<span class="sc">$</span>mpg <span class="sc">^</span> lambda_BC<span class="sc">$</span>lambda) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda_BC<span class="sc">$</span>lambda)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>modelo_multi_2_bc <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg_bc<span class="sc">~</span> hp <span class="sc">+</span> wt, df2)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_multi_2_bc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg_bc ~ hp + wt, data = df2)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.20511 -0.08248 -0.02739  0.06790  0.31116 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.0428360  0.0750633  53.859  &lt; 2e-16 ***
hp          -0.0016878  0.0004239  -3.981 0.000421 ***
wt          -0.2185744  0.0297069  -7.358 4.18e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1218 on 29 degrees of freedom
Multiple R-squared:  0.8687,    Adjusted R-squared:  0.8596 
F-statistic: 95.91 on 2 and 29 DF,  p-value: 1.646e-13</code></pre>
</div>
</div>
<p>Agora vamos visualizar e testar a normalidade dos resíduos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (modelo_multi_2_bc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="RegLinear-01_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Testes de Normalidade, Homocedasticidade e Outliers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste sharpiro-francia (ou sharpiro-wilk para amostrar &lt; 30)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sf.test</span>(modelo_multi_2_bc<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Francia normality test

data:  modelo_multi_2_bc$residuals
W = 0.95845, p-value = 0.2145</code></pre>
</div>
</div>
<p>Como podemos observar, nossos resíduos agora <strong>passam</strong> no teste de normalidade (p-value &gt; 0.05). .</p>
<p><strong>Outliers nos resíduos</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Os resíduos PADRONIZADOS devem estar entre -3 e +3 e mediana perto de zero</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rstandard</span>(modelo_multi_2_bc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1.71335 -0.71578 -0.24297  0.01259  0.58248  2.83329 </code></pre>
</div>
</div>
<p>No caso acima, não temos outliers nos resíduos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Independência dos resíduos. Não se aplicaria aqui, mas deixamos o código. Em geral, quando temos análise longitudinal (medidas repetidas), ex. Time series.</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Recomendação de 1 e 3. p-value &gt; 0.05 os resíduos são independentes. Teste adequando quando os resíduos atendem a normalidade.</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">durbinWatsonTest</span>(modelo_multi_2_bc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> lag Autocorrelation D-W Statistic p-value
   1       0.1855612      1.601514   0.192
 Alternative hypothesis: rho != 0</code></pre>
</div>
</div>
<p>Homocedasticidade:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Teste de Breush-Pagan. Também tem premissa de normalidade nos resíduos.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#H0 existe homocedasticidade e H1 Não existe, ou sejá, tem Heterocedasticidade.</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste caso, p-valor &gt; 0.05, portanto temos homocedasticidade.</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">bptest</span>(modelo_multi_2_bc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  modelo_multi_2_bc
BP = 3.2947, df = 2, p-value = 0.1926</code></pre>
</div>
</div>
</section>
<section id="salvando-os-fitted-values-box-cox" class="level2">
<h2 class="anchored" data-anchor-id="salvando-os-fitted-values-box-cox">Salvando os fitted values Box-Cox:</h2>
<p>Como fizemos o modelo com os valores transformados, precisamos lembrar de aplicar a fórmula inversa para termos o valor de mpg adequado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>mpg_bc_fitted <span class="ot">&lt;-</span> (((modelo_multi_2_bc<span class="sc">$</span>fitted.values<span class="sc">*</span>(lambda_BC<span class="sc">$</span>lambda))<span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">1</span>))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>(lambda_BC<span class="sc">$</span>lambda))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos utilizar agora a função <strong>predict</strong>() para estimar nosso consumo com o novo modelo multivariado com a a transformação de Box-Cox para um veículo com 3000 libras de peso e 190 de potência:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_previsao_bc <span class="ot">=</span> <span class="fu">tibble</span>(<span class="st">"hp"</span> <span class="ot">=</span> <span class="dv">190</span>, <span class="st">"wt"</span> <span class="ot">=</span> <span class="fl">3.0</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(modelo_multi_2_bc, <span class="at">newdata =</span> df_previsao_bc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1 
3.06644 </code></pre>
</div>
</div>
<p>Veja que esta previsão é o valor transformado, portanto, para saber o valor correto, devemos fazer a operação inversa da transformação, ou seja, multiplicar pelo lambda e elevar a 1/lambda.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>((<span class="fl">3.06644</span> <span class="sc">*</span> (lambda_BC<span class="sc">$</span>lambda)) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>(lambda_BC<span class="sc">$</span>lambda))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> df2$mpg 
18.82727 </code></pre>
</div>
</div>
<p>Colocando direto no código, temos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_previsao_bc <span class="ot">=</span> <span class="fu">tibble</span>(<span class="st">"hp"</span> <span class="ot">=</span> <span class="dv">190</span>, <span class="st">"wt"</span> <span class="ot">=</span> <span class="fl">3.0</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>previsao <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_multi_2_bc, <span class="at">newdata =</span> df_previsao_bc)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>((previsao <span class="sc">*</span> (lambda_BC<span class="sc">$</span>lambda)) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>(lambda_BC<span class="sc">$</span>lambda))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
18.82726 </code></pre>
</div>
</div>
</section>
<section id="visualizando-a-inferência-1" class="level2">
<h2 class="anchored" data-anchor-id="visualizando-a-inferência-1">Visualizando a inferência:</h2>
<p>Neste caso, como temos duas variáveis explicativas, iremos criar um gráfico 3D para visualizar o hiper-plano da regressão:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(df2, <span class="at">x=</span> <span class="sc">~</span>mpg, <span class="at">y=</span><span class="sc">~</span>hp, <span class="at">z=</span><span class="sc">~</span>wt) <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>(<span class="at">name =</span> <span class="st">"Dados Treino"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>(<span class="at">x =</span> <span class="fl">18.83</span>, <span class="at">y =</span> <span class="dv">190</span>, <span class="at">z =</span> <span class="fl">3.0</span>, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">name =</span> <span class="st">"Previsao"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-86e43916d81d70a0ea3b" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-86e43916d81d70a0ea3b">{"x":{"visdat":{"58ac55d22eac":["function () ","plotlyVisDat"]},"cur_data":"58ac55d22eac","attrs":{"58ac55d22eac":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","mode":"markers","name":"Dados Treino","inherit":true},"58ac55d22eac.1":{"x":18.83,"y":190,"z":3,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","mode":"markers","name":"Previsao","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"mpg"},"yaxis":{"title":"hp"},"zaxis":{"title":"wt"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],"y":[110,110,93,110,175,105,245,62,95,123,123,180,180,180,205,215,230,66,52,65,97,150,150,245,175,66,91,113,264,175,335,109],"z":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],"type":"scatter3d","mode":"markers","name":"Dados Treino","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[18.83],"y":[190],"z":[3],"type":"scatter3d","mode":"markers","name":"Previsao","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observe que até o momento, utilziamos variáveis explicativas quantitativas. Caso precise utilizar variáveis, você precisará fazer um processo transformando a variável qualitativa em variáveis “dummy”.</p>
</div>
</div>
<!-- ## Visualizando as correlações (ERRADO) -->
<!-- A seguir, iremos analisar as correlações e criar um modelo linear de forma similar à que fizemos até aqui.  -->
<!-- :::callout-warning -->
<!-- CUIDADO!!! Estamos fazendo este procedimento de forma INCORRETA para mostrar alguns pontos importantes logo adiante. -->
<!-- ::: -->
<!-- ```{r} -->
<!-- df |> select(mpg, hp, cyl) |>  -->
<!-- DataExplorer::plot_correlation() -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #fig <-  plot_ly(df, x = ~hp, y = ~mpg, z = ~cyl, color = ~mpg, colors = c('darkred', 'green'), size = 1) |>  -->
<!-- #  add_markers() -->
<!-- #fig -->
<!-- ``` -->
<!-- ## Criando o modelo (ERRADO) -->
<!-- Este modelo é errado, pois a variável "cyl", apesar de em nosso dataset estar configurada como "double" (quatitativa), ela é apenas um label para definir o tipo de cilindro é o automável, portanto é qualitativa. PNeste caso, suas proporções são: -->
<!-- ```{r} -->
<!-- #Frequencia absoluta: -->

<!-- table(df$cyl) -->
<!-- #Frequencia Relativa: -->

<!-- prop.table(table(df$cyl)) -->
<!-- ``` -->
<!-- Como na tabela df, ela está como double, a função lm(), está tratando seus valores numéricos, ou seja, as diferenças entre 4, 6 e 8. -->
<!-- ## Rodando o modelo ERRADO! -->
<!-- ```{r} -->
<!-- modelo_multi_errado <- lm(mpg ~ hp + cyl, df) -->
<!-- summary (modelo_multi_errado) -->
<!-- ``` -->
<!-- Aqui vale algumas observações. A primeira é que a variável "hp", deixa de ser estatisticamente significante (a 95% de confiança) após a introdução da variável "cyl". Veremos mais sobre este ponto a seguir. -->
<!-- Veja também que ele gera um beta para a variável "cyl". Sabemos que isto não significa nada, pois estamos ainda lidando com a variável cilindros como quantitativa, o que está incorreto! -->
<!-- ## Ponderação Arbitrária: -->
<!-- Para entender melhor, veja o que está acontencendo. Sabemos que devemos mudar a variável "cyl" que está originalmente quantitativa (4,6 e 8) para qualitativa. -->
<!-- Porém, é um procedimento comum e incorreto atribuir valores de forma arbitrária, sendo estes, 1,2 e 3 ou 4,6 e 8, etc. Estes números são apenas "labels" para representar categorias desta variável. -->
<!-- Veja as médias adequadas quando mudamos a variável "cyl" como qualitativa: -->
<!-- ```{r} -->
<!-- df_cyl_medias <- df |> mutate (cyl = as_factor(cyl)) |>  -->
<!--   group_by(cyl) |> summarise(media = mean(mpg)) -->
<!-- df_cyl_medias -->
<!-- ``` -->
<!-- ### Visualizando as diferenças com ponderação arbitrária -->
<!-- Visualizando o modelo errado (com ponderação arbitrária de 1,2 e 3 e as médias certas (em vermelho): -->
<!-- ```{r} -->
<!-- df |>  -->
<!--   ggplot(aes(x=cyl, y=mpg))+ -->
<!--   geom_point()+ -->
<!--   geom_text_repel(aes(label=name))+ -->
<!--   geom_smooth(method="lm", se=F)+ -->
<!--   geom_point(data = df_cyl_medias, aes(x=parse_number(levels(cyl)), y=media), color = "red") -->
<!-- ``` -->
<!-- Observe como seria a inclinação dos betas considerando a frenquência média de cada categoria na variável cyl: -->
<!-- ```{r} -->
<!-- df |>  -->
<!--   ggplot(aes(x=as_factor(cyl), y=mpg))+ -->
<!--   geom_point()+ -->
<!--   geom_text_repel(aes(label=name))+ -->
<!--   geom_line(data = df_cyl_medias, aes(x=cyl, y=media,group =1), size =1.2,color = "blue")+ -->
<!--   geom_point(data = df_cyl_medias, aes(x=cyl, y=media), color = "red") -->
<!-- ``` -->
<!-- :::callout-note -->
<!-- É por estre motivo que não podemos fazer a penderação arbitrária de valores para variáveis categóricas. Existe um procedimento adequado para lidar com esta situação que veremos a seguir. -->
<!-- ::: -->
<!-- # Ajuste das variáveis qualitativas -->
<!-- Para adequar devidamente variáveis explicativas (x) categóricas para utilizarmos em modelos OLS, devemos criar variáveis adicionais "dummys". -->
<!-- Faremos isto através da função dummy_columns: -->
<!-- ```{r} -->
<!-- df_fct <- df |> mutate (cyl = as_factor(cyl)) -->
<!-- df_fct_dummy <- fastDummies::dummy_columns(df_fct, select_columns = "cyl", -->
<!--                                    remove_selected_columns = T, -->
<!--                                    remove_first_dummy = T) -->
<!-- df_fct_dummy  -->
<!-- ``` -->
<!-- Neste caso, ele atribui a existência (1) ou não existência (0) para cada categoria da variável quantitativa -1. Ou seja, no caso da variável cilindro, teremos 2 novas variáveis dummys (cyl_6 e cyl_8), sendo que a categoria de referência (cyl_4) é incluída no alpha da equação. -->
<!-- # Criando o modelo com as dummys -->
<!-- Agora com a variável "cyl" devidamente "dummizada" podemos rodar o modelo: -->
<!-- Rodando o modelo com dummy: -->
<!-- ```{r} -->
<!-- modelo_multi_dummy <- lm(mpg ~ hp + cyl_6 + cyl_8, df_fct_dummy) -->
<!-- summary (modelo_multi_dummy) -->
<!-- ``` -->
<!-- Apesar de termos feito o processo de dummys, saiba que a função lm() é inteligente o suficiente e já faz este processo quando recebe uma variável factor. Veja: -->
<!-- ```{r} -->
<!-- #OBS: Não precisamos montar as dummys de forma manual, pois a função já faz estes procedimento.  -->
<!-- modelo_multi_fct <- lm(mpg ~ hp + cyl, df_fct) -->
<!-- summary (modelo_multi_fct) -->
<!-- ``` -->
<!-- ## Variáveis Explicativas Estatisticamente Significantes -->
<!-- Observe que apesar de no modelo com dummy, termos um p-valor para a estatística F, a estatística T da variável "hp" não é mais estatisticamente significante à 95% de nível de confiança. Isto pode se dar por 3 fatores: -->
<!-- 1-) Esta variável sozinha não é estatisticamente significante para explicar a variável y. Já vimos que isto não é verdade, pois ela passa quando fazemos um modelo com ela sozinha (p-valor = 0.000000179): -->
<!-- ```{r} -->
<!-- summary(modelo_uni) -->
<!-- ``` -->
<!-- 2-) Quando há multicolinearidade entre ela e outra variável explicativa. -->
<!-- No exemplo abaixo, vemos uma forte correlação entre "cilindro" com "hp" -->
<!-- ```{r} -->
<!-- df_fct_dummy |>  -->
<!--   select (mpg, hp, cyl_6, cyl_8) |>  -->
<!--   correlation::correlation(method = "pearson") |>  plot() -->
<!-- ``` -->
<!-- Neste caso, ao adicionar a variável cilindros (cyl), a variável "hp" deve ser removida do modelo, pois não é mais estatisticamente significante à 95% de confiança. -->
<!-- ## Stepwise -->
<!-- Poderíamos remover manualmente a variável "hp", porém em alguns casos, a troca de variáveis explicativas, faz com que níveis de significâncias se alterem dependendo da combinação, pois eventualmente, uma variável pode ser proxy de outra, etc. -->
<!-- Neste caso, podemos utilizar um algoritmo "stepwise" a um nível de significância de 5% para que tenhamos as melhores combinações de variáveis para o modelo. -->
<!-- ```{r} -->
<!-- modelo_multi_dummy_step <- step(modelo_multi_dummy,  -->
<!--                                       k = qchisq(p = 0.05, df = 1, lower.tail = F)) -->
<!-- summary(modelo_multi_dummy_step) -->
<!-- ``` -->
<!-- ## Normalidade dos Resíduos -->
<!-- Para verificar a normalidade dos resíduos iremos utilizar novamente o teste shapiro-francia.  -->
<!-- ```{r} -->
<!-- sf.test(modelo_uni$residuals) -->
<!-- sf.test(modelo_multi_dummy$residuals) -->
<!-- sf.test(modelo_multi_dummy_step$residuals) -->
<!-- ``` -->
<!-- Neste caso, observamos que os resíduos no modelo univariado não passa no teste de normalidade, já nos modelos multivariados ele passa.  -->
<!-- Porém, há alguns cenários onde a variável dependente é não linear. Neste caso, temos uma terceira possibilidade que veremos a seguir. -->
<!-- Visualizando o modelo certo: -->
<!-- Vamos agora incluir os valores estimados em nossa tabela de treinamento: -->
<!-- ```{r} -->
<!-- #df_fct$fit_1 <- modelo_uni$fitted.values -->
<!-- #df_fct$fit_2 <- modelo_multi_dummy$fitted.values -->
<!-- df_fct$fit_3 <- modelo_multi_dummy_step$fitted.values -->
<!-- df_fct |>  -->
<!--   ggplot(aes(x=mpg, y=mpg))+ -->
<!--   geom_smooth(aes(y = mpg), method = "lm",  -->
<!--               color = "green", size = 1.05, -->
<!--               linetype = "longdash") + -->
<!--  # geom_point(aes(y=fit_1), color = "blue") + -->
<!--  # geom_point(aes(y=fit_2), color = "orange") + -->
<!--   geom_point(aes(y=fit_3), color = "darkgray")  -->
<!-- ``` -->
<!-- Apesar dos resíduos do modelo após o stepwise serem aderentes à normalidade, iremos seguir com o terceiro cenário, apenas para ilusrtar o procedimento de quando isso não tivesse acontecido. -->
<!-- 3-) Quando a variável Y apresenta uma forma não linear. -->
<!-- Quando a variável dependende apresentar uma forma funcional não linear nosso modelo pode apresentar resíduosque não atendem à uma distribuição.  -->
<!-- Quando isto acontece, podemos tentar fazer uma transformação (ex: box-cox) para ajustar o modelo. -->
<!-- Por exemplo: -->
<!-- ```{r} -->
<!-- #Estimando o lambda de BoxCox -->
<!-- lambda_BC <- car::powerTransform(df_fct$mpg) -->
<!-- lambda_BC -->
<!-- #Adicionando na base de dados: -->
<!-- df_fct_dummy$mpg_bc <- (((df_fct$mpg ^ lambda_BC$lambda) - 1) /  -->
<!--                                       lambda_BC$lambda) -->
<!-- ``` -->
<!-- Agora, rodamos um modelo à partir da variável normalizada -->
<!-- ```{r} -->
<!-- modelo_multi_dummy_bc <- lm(mpg_bc ~ hp + cyl_6 + cyl_8, data = df_fct_dummy) -->
<!-- summary(modelo_multi_dummy_bc) -->
<!-- ``` -->
<!-- Aplicamos o stepwise: -->
<!-- ```{r} -->
<!-- modelo_multi_dummy_bc_step <- step(modelo_multi_dummy_bc,k = 3.841459) -->
<!-- summary(modelo_multi_dummy_bc_step) -->
<!-- ``` -->
<!-- Agora, podemos validar os resíduos à normalidade: -->
<!-- ```{r} -->
<!-- sf.test(modelo_multi_dummy_bc_step$residuals) -->
<!-- ``` -->
<!-- Adicoinamos os fitted na base e comparando os residuos: -->
<!-- ```{r} -->
<!-- df_fct_dummy$fit <- modelo_multi_dummy_bc_step$fitted.values -->
<!-- df_fct_dummy$residuos <- modelo_multi_dummy_bc_step$residuals -->
<!--   df_fct_dummy |>  -->
<!--   ggplot(aes(x = residuos)) + -->
<!--   geom_histogram(aes(y = ..density..),  -->
<!--                  color = "grey50",  -->
<!--                  fill = "grey90",  -->
<!--                  bins = 30, -->
<!--                  alpha = 0.6) + -->
<!--   stat_function(fun = dnorm,  -->
<!--                 args = list(mean = mean(modelo_multi_dummy_bc_step$residuals), -->
<!--                             sd = sd(modelo_multi_dummy_bc_step$residuals)), -->
<!--                 aes(color = "Curva Normal Teórica"), -->
<!--                 size = 2) + -->
<!--   scale_color_manual("Legenda:", -->
<!--                      values = "#FDE725FF") + -->
<!--   labs(x = "Resíduos", -->
<!--        y = "Frequência") + -->
<!--   theme(panel.background = element_rect("white"), -->
<!--         panel.grid = element_line("grey95"), -->
<!--         panel.border = element_rect(NA), -->
<!--         legend.position = "bottom") -->
<!-- ``` -->
<!-- Salvando os fitted na base: -->
<!-- ```{r} -->
<!-- df_fct_dummy$fit_bc_step <- (((modelo_multi_dummy_bc_step$fitted.values*(lambda_BC$lambda))+ -->
<!--                                     1))^(1/(lambda_BC$lambda)) -->
<!-- ``` -->
<!-- Visualizando: -->
<!-- ```{r} -->
<!-- df_fct_dummy |>  -->
<!--   ggplot(aes(x=mpg, y=mpg))+ -->
<!--   geom_smooth(aes(y = mpg), method = "lm",  -->
<!--               color = "green", size = 1.05, -->
<!--               linetype = "longdash") + -->
<!--  # geom_point(aes(y=fit_1), color = "blue") + -->
<!--  # geom_point(aes(y=fit_2), color = "orange") + -->
<!--   geom_point(aes(y=fit_bc_step), color = "darkgray")  -->
<!-- ``` -->
<!-- Comparando os modelos uni e multi-variado com variável dummy: -->
<!-- ```{r} -->
<!-- summary(modelo_uni)$adj.r.squared -->
<!-- summary(modelo_multi_dummy_step)$adj.r.squared -->
<!-- summary(modelo_multi_dummy_bc_step)$adj.r.squared -->
<!-- ``` -->
<!-- Observamos que o R2 ajustado (para comparação de modelos) é bem maior quando dicionamos a variável cyl. -->
<!-- #Modelo multi-nivel -->
<!-- Agora veremos uma abordagem multi-nivel, onde os betas são estimados em relação à grupos que adicionam  -->
<!-- ```{r} -->
<!-- df_pred <- tibble(hp = 190, cyl_6 = 0, cyl_8 = 1)   -->
<!-- fit <- predict(modelo_multi_dummy_bc_step, df_pred) -->
<!-- df_pred <- df_pred |> mutate (fit = ((fit * lambda_BC$lambda) + 1)^(1/(lambda_BC$lambda))) -->
<!-- df_pred  -->
<!-- ``` -->
<!-- ```{r} -->
<!-- df_fct_dummy$cyl <- df_fct$cyl -->
<!-- df_fct_dummy |>  -->
<!--   ggplot(aes(x=cyl, y=mpg))+ -->
<!--   geom_point()+ -->
<!--   geom_text_repel(aes(label=name))+ -->
<!--   geom_jitter(aes(y=fit_bc_step), color = "blue") -->
<!-- ``` -->
<!-- # Teste de Heterocedasticidade: -->
<!-- ```{r} -->
<!-- #Diagnóstico de Heterocedasticidade para o Modelo Stepwise com Box-Cox -->
<!-- olsrr::ols_test_breusch_pagan(modelo_multi_dummy_bc_step) -->
<!-- ``` -->
<!-- # Analise multi-nível -->
<!-- TBD -->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>